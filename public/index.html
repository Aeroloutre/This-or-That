<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link href="style.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>


  <title>This or That</title>

</head>

<body>


  <h1 class="text-4xl font-bold">
    This or That
  </h1>

  <h1 class="text-1xl font-bold">
    The game
  </h1>

  <div id="start" class="midCentered">
    <div class="blue-border">
      <button class="text-2xl font-bold" type="button"> START </button>
    </div>
  </div>

  <div id="content">

    <div class="centered">
      <button id="this" type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        this
      </button>
    </div>

    <div class="centered">
      <h1 class="text-2xl font-bold">
        OR
      </h1>
    </div>

    <div class="centered">
      <button id="that" type="button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        That
      </button>
    </div>

    <div class="centered">
      <h1 class="text-2xl font-bold">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" id="next" type="button">
          NEXT
        </button>
      </h1>
    </div>

    <div class ="centered">
      <a href="index2.html">Submit a question !</a>
    </div>

  </div>

  <script>
    let data = [];
    let keys = [];
    let arraySize;
    let toDisplayVote1;
    let toDisplayVote2;
    let randomInt;
    let numeroDeQuestion;

    const content = document.getElementById("content");
    const next = document.getElementById("next");
    const elementStart = document.getElementById("start");
    const elementThis = document.getElementById("this");
    const elementThat = document.getElementById("that");
    const elementNext = document.getElementById("next");

    content.style.display = "none";
    next.style.display = "none";

    fetch('/questions')
      .then(response => response.json())
      .then(json => {
        data = json;
        console.log('Questions reçues :', data);

        data.forEach(obj => {
          keys.push(...Object.keys(obj));
        });
        arraySize = data.length - 1;

        elementStart.addEventListener("click", initialisation);

        console.log('data =', data);
        console.log('data[0] =', data[0]);
        console.log('data[1] =', data[1]);
        console.log('keys =', keys);
      })
      .catch(error => console.error('Erreur lors de la récupération des questions', error));

    elementNext.addEventListener("click", nextButton);

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min);
    }

    function initialisation() {
      console.log("initialisation")

      content.style.display = "block";
      elementStart.style.display = "none";

      numeroDeQuestion = getRandomInt(0, arraySize);
      console.log(numeroDeQuestion)

      const localKeys = Object.keys(data[numeroDeQuestion]);

      toDisplayVote1 = data[numeroDeQuestion][localKeys[0]];
      console.log(toDisplayVote1);
      toDisplayVote2 = data[numeroDeQuestion][localKeys[1]];
      console.log(toDisplayVote2);

      document.getElementById("this").innerHTML = Object.keys(data[numeroDeQuestion])[0];
      document.getElementById("that").innerHTML = Object.keys(data[numeroDeQuestion])[1];

      elementThis.addEventListener("click", displayResult,{once: true}); // TODO Ajouter l'enregistrement du vote
      elementThat.addEventListener("click", displayResult,{once: true}); // TODO Ajouter l'enregistrement du vote
    }

    function displayResult() {
      console.log("displayResult")

      document.getElementById("this").innerHTML = toDisplayVote1
      document.getElementById("that").innerHTML = toDisplayVote2

      next.style.display = "block";

      elementThis.removeEventListener("click", displayResult)
      elementThat.removeEventListener("click", displayResult)
    } 
/*
    function sendVoteToServer(questionObj, voteKey) {
      const voteData = {
        question: [questionObj.Question1, questionObj.Question2],
        vote: voteKey,
        timestamp: new Date().toISOString()
      };
      
    }
    */

    function nextButton() {
      console.log("next button")
      document.getElementById("this").innerHTML = "This";
      document.getElementById("that").innerHTML = "That";
      next.style.display = "none"

      initialisation();
    }

  </script>

</body>

</html>